<!DOCTYPE html>
<html xmlns="http://www.w3.org/1999/xhtml" lang="en" xml:lang="en"><head>

<meta charset="utf-8">
<meta name="generator" content="quarto-1.4.555">

<meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=yes">

<meta name="author" content="Dr.&nbsp;Lea Hildebrandt">

<title>Biostatistics - 15 Reproducible Research</title>
<style>
code{white-space: pre-wrap;}
span.smallcaps{font-variant: small-caps;}
div.columns{display: flex; gap: min(4vw, 1.5em);}
div.column{flex: auto; overflow-x: auto;}
div.hanging-indent{margin-left: 1.5em; text-indent: -1.5em;}
ul.task-list{list-style: none;}
ul.task-list li input[type="checkbox"] {
  width: 0.8em;
  margin: 0 0.8em 0.2em -1em; /* quarto-specific, see https://github.com/quarto-dev/quarto-cli/issues/4556 */ 
  vertical-align: middle;
}
/* CSS for syntax highlighting */
pre > code.sourceCode { white-space: pre; position: relative; }
pre > code.sourceCode > span { line-height: 1.25; }
pre > code.sourceCode > span:empty { height: 1.2em; }
.sourceCode { overflow: visible; }
code.sourceCode > span { color: inherit; text-decoration: inherit; }
div.sourceCode { margin: 1em 0; }
pre.sourceCode { margin: 0; }
@media screen {
div.sourceCode { overflow: auto; }
}
@media print {
pre > code.sourceCode { white-space: pre-wrap; }
pre > code.sourceCode > span { text-indent: -5em; padding-left: 5em; }
}
pre.numberSource code
  { counter-reset: source-line 0; }
pre.numberSource code > span
  { position: relative; left: -4em; counter-increment: source-line; }
pre.numberSource code > span > a:first-child::before
  { content: counter(source-line);
    position: relative; left: -1em; text-align: right; vertical-align: baseline;
    border: none; display: inline-block;
    -webkit-touch-callout: none; -webkit-user-select: none;
    -khtml-user-select: none; -moz-user-select: none;
    -ms-user-select: none; user-select: none;
    padding: 0 4px; width: 4em;
  }
pre.numberSource { margin-left: 3em;  padding-left: 4px; }
div.sourceCode
  {   }
@media screen {
pre > code.sourceCode > span > a:first-child::before { text-decoration: underline; }
}
</style>


<script src="site_libs/quarto-nav/quarto-nav.js"></script>
<script src="site_libs/quarto-nav/headroom.min.js"></script>
<script src="site_libs/clipboard/clipboard.min.js"></script>
<script src="site_libs/quarto-search/autocomplete.umd.js"></script>
<script src="site_libs/quarto-search/fuse.min.js"></script>
<script src="site_libs/quarto-search/quarto-search.js"></script>
<meta name="quarto:offset" content="./">
<script src="site_libs/quarto-html/quarto.js"></script>
<script src="site_libs/quarto-html/popper.min.js"></script>
<script src="site_libs/quarto-html/tippy.umd.min.js"></script>
<script src="site_libs/quarto-html/anchor.min.js"></script>
<link href="site_libs/quarto-html/tippy.css" rel="stylesheet">
<link href="site_libs/quarto-html/quarto-syntax-highlighting.css" rel="stylesheet" id="quarto-text-highlighting-styles">
<script src="site_libs/bootstrap/bootstrap.min.js"></script>
<link href="site_libs/bootstrap/bootstrap-icons.css" rel="stylesheet">
<link href="site_libs/bootstrap/bootstrap.min.css" rel="stylesheet" id="quarto-bootstrap" data-mode="light">
<script id="quarto-search-options" type="application/json">{
  "location": "sidebar",
  "copy-button": false,
  "collapse-after": 3,
  "panel-placement": "start",
  "type": "textbox",
  "limit": 50,
  "keyboard-shortcut": [
    "f",
    "/",
    "s"
  ],
  "show-item-context": false,
  "language": {
    "search-no-results-text": "No results",
    "search-matching-documents-text": "matching documents",
    "search-copy-link-title": "Copy link to search",
    "search-hide-matches-text": "Hide additional matches",
    "search-more-match-text": "more match in this document",
    "search-more-matches-text": "more matches in this document",
    "search-clear-button-title": "Clear",
    "search-text-placeholder": "",
    "search-detached-cancel-button-title": "Cancel",
    "search-submit-button-title": "Submit",
    "search-label": "Search"
  }
}</script>

  <script src="https://polyfill.io/v3/polyfill.min.js?features=es6"></script>
  <script src="https://cdn.jsdelivr.net/npm/mathjax@3/es5/tex-chtml-full.js" type="text/javascript"></script>

<script type="text/javascript">
const typesetMath = (el) => {
  if (window.MathJax) {
    // MathJax Typeset
    window.MathJax.typeset([el]);
  } else if (window.katex) {
    // KaTeX Render
    var mathElements = el.getElementsByClassName("math");
    var macros = [];
    for (var i = 0; i < mathElements.length; i++) {
      var texText = mathElements[i].firstChild;
      if (mathElements[i].tagName == "SPAN") {
        window.katex.render(texText.data, mathElements[i], {
          displayMode: mathElements[i].classList.contains('display'),
          throwOnError: false,
          macros: macros,
          fleqn: false
        });
      }
    }
  }
}
window.Quarto = {
  typesetMath
};
</script>

</head>

<body class="nav-sidebar floating">

<div id="quarto-search-results"></div>
  <header id="quarto-header" class="headroom fixed-top">
  <nav class="quarto-secondary-nav">
    <div class="container-fluid d-flex">
      <button type="button" class="quarto-btn-toggle btn" data-bs-toggle="collapse" data-bs-target=".quarto-sidebar-collapse-item" aria-controls="quarto-sidebar" aria-expanded="false" aria-label="Toggle sidebar navigation" onclick="if (window.quartoToggleHeadroom) { window.quartoToggleHeadroom(); }">
        <i class="bi bi-layout-text-sidebar-reverse"></i>
      </button>
        <nav class="quarto-page-breadcrumbs" aria-label="breadcrumb"><ol class="breadcrumb"><li class="breadcrumb-item"><a href="./W15_RepResearchR.html">15 Reproducible Research</a></li></ol></nav>
        <a class="flex-grow-1" role="button" data-bs-toggle="collapse" data-bs-target=".quarto-sidebar-collapse-item" aria-controls="quarto-sidebar" aria-expanded="false" aria-label="Toggle sidebar navigation" onclick="if (window.quartoToggleHeadroom) { window.quartoToggleHeadroom(); }">      
        </a>
      <button type="button" class="btn quarto-search-button" aria-label="" onclick="window.quartoOpenSearch();">
        <i class="bi bi-search"></i>
      </button>
    </div>
  </nav>
</header>
<!-- content -->
<div id="quarto-content" class="quarto-container page-columns page-rows-contents page-layout-article">
<!-- sidebar -->
  <nav id="quarto-sidebar" class="sidebar collapse collapse-horizontal quarto-sidebar-collapse-item sidebar-navigation floating overflow-auto">
    <div class="pt-lg-2 mt-2 text-left sidebar-header">
    <div class="sidebar-title mb-0 py-0">
      <a href="./">Biostatistics</a> 
    </div>
      </div>
        <div class="mt-2 flex-shrink-0 align-items-center">
        <div class="sidebar-search">
        <div id="quarto-search" class="" title="Search"></div>
        </div>
        </div>
    <div class="sidebar-menu-container"> 
    <ul class="list-unstyled mt-1">
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./W1_Intro.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">01a Introduction to Biostatistics</span></a>
  </div>
</li>
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./W1b_IntroR.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">01b Intro to R</span></a>
  </div>
</li>
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./W2_Models.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">02 Models</span></a>
  </div>
</li>
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./W3_DataWranglingR.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">03 Data Wrangling</span></a>
  </div>
</li>
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./W4_DataVizR.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">04 Data Visualization</span></a>
  </div>
</li>
        <li class="sidebar-item">
 <span class="menu-text">W5_Sampling.qmd</span>
  </li>
        <li class="sidebar-item">
 <span class="menu-text">W6_ProbabilityR.qmd</span>
  </li>
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./W7_Hypothesis.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">07 Hypothesis Testing</span></a>
  </div>
</li>
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./W8_ModelingRelationships.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">08 Modeling Relationships</span></a>
  </div>
</li>
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./W9_FirstAnalysisR.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">09 Statistical Analyses in R</span></a>
  </div>
</li>
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./W10_GLM.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">10 The General Linear Model &amp; Multivariate Statistics</span></a>
  </div>
</li>
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./W11_GLMinR.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">11 ANOVA &amp; the General Linear Model in R</span></a>
  </div>
</li>
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./W12_LMM.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">12 Linear Mixed Models</span></a>
  </div>
</li>
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./W13_RMarkdown.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">13 R Markdown</span></a>
  </div>
</li>
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./W15_RepResearchR.html" class="sidebar-item-text sidebar-link active">
 <span class="menu-text">15 Reproducible Research</span></a>
  </div>
</li>
    </ul>
    </div>
</nav>
<div id="quarto-sidebar-glass" class="quarto-sidebar-collapse-item" data-bs-toggle="collapse" data-bs-target=".quarto-sidebar-collapse-item"></div>
<!-- margin-sidebar -->
    <div id="quarto-margin-sidebar" class="sidebar margin-sidebar">
        
    <div class="quarto-alternate-formats"><h2>Other Formats</h2><ul><li><a href="W15_RepResearchR.html"><i class="bi bi-file-slides"></i>RevealJS</a></li></ul></div></div>
<!-- main -->
<main class="content" id="quarto-document-content">

<header id="title-block-header" class="quarto-title-block default">
<div class="quarto-title">
<h1 class="title">15 Reproducible Research</h1>
<p class="subtitle lead"></p><div class="line-block">Julius-Maximilians-University W√ºrzburg<br>
Course: ‚ÄúBiostatistics‚Äù<br>
Translational Neuroscience</div><p></p>
</div>



<div class="quarto-title-meta">

    <div>
    <div class="quarto-title-meta-heading">Author</div>
    <div class="quarto-title-meta-contents">
             <p>Dr.&nbsp;Lea Hildebrandt </p>
          </div>
  </div>
    
  
    
  </div>
  


</header>


<section id="what-is-reproducible-research" class="level1">
<h1>What is Reproducible Research?</h1>
<div class="cell">
<div class="sourceCode cell-code" id="cb1"><pre class="sourceCode css code-with-copy"><code class="sourceCode css"><span id="cb1-1"><a href="#cb1-1" aria-hidden="true" tabindex="-1"></a>code<span class="fu">.sourceCode</span> {</span>
<span id="cb1-2"><a href="#cb1-2" aria-hidden="true" tabindex="-1"></a>  <span class="kw">font-size</span><span class="ch">:</span> <span class="dv">1.4</span><span class="dt">em</span><span class="op">;</span></span>
<span id="cb1-3"><a href="#cb1-3" aria-hidden="true" tabindex="-1"></a>}</span>
<span id="cb1-4"><a href="#cb1-4" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb1-5"><a href="#cb1-5" aria-hidden="true" tabindex="-1"></a>div<span class="fu">.cell-output-stdout</span> {</span>
<span id="cb1-6"><a href="#cb1-6" aria-hidden="true" tabindex="-1"></a>  <span class="kw">font-size</span><span class="ch">:</span> <span class="dv">1.4</span><span class="dt">em</span><span class="op">;</span></span>
<span id="cb1-7"><a href="#cb1-7" aria-hidden="true" tabindex="-1"></a>}</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<style type="text/css">
code.sourceCode {
  font-size: 1.4em;
}

div.cell-output-stdout {
  font-size: 1.4em;
}
</style>
</div>
<p>Traditionally, there has been a lot of trust in scientific results. In the last years, however, this trust has decreased, and we know that science may not always work as well (‚Äúreplication crisis‚Äù).</p>
<section id="how-we-think-science-should-work" class="level2">
<h2 class="anchored" data-anchor-id="how-we-think-science-should-work">How we Think Science Should Work</h2>
<div class="incremental">
<ol class="incremental" type="1">
<li>You have a hypothesis
<ul class="incremental">
<li>Branding food with popular characters causes children to choose ‚Äúhealthy‚Äù food</li>
</ul></li>
<li>You collect some data
<ul class="incremental">
<li>Children can choose between cookie and apple with either Elmo-sticker or control condition</li>
</ul></li>
<li>You do statistics (often to test the null hypothesis)
<ul class="incremental">
<li>‚ÄúThe preplanned comparison shows Elmo-branded apples were associated with an increase in a child‚Äôs selection of an apple over a cookie, from 20.7% to 33.8% (œá2=5.158; P=.02)‚Äù (<a href="https://statsthinking21.github.io/statsthinking21-core-site/doing-reproducible-research.html#ref-wans:just:payn:2012">Wansink, Just, and Payne 2012</a>)</li>
</ul></li>
<li>You make a conclusion based on the data
<ul class="incremental">
<li>Branding can increase healthy choices in young children‚Ä¶</li>
</ul></li>
</ol>
</div>
<p>. . .</p>
<div class="quarto-figure quarto-figure-center">
<figure class="figure">
<p><a href="https://www.nature.com/articles/s41562-016-0021"><img src="images/RepRes_Munafo_raw.png" class="img-fluid figure-img" width="518" alt="The Research Cycle (Munafo et.al., 2017)"></a></p>
<figcaption>The Research Cycle (Munafo et.al., 2017)</figcaption>
</figure>
</div>
<div class="notes">
<p>= scientific cycle</p>
</div>
</section>
<section id="how-science-sometimes-actually-works" class="level2">
<h2 class="anchored" data-anchor-id="how-science-sometimes-actually-works">How Science (Sometimes) Actually Works</h2>
<p>The example on the last slide summarized a study by Brian Wansink. He was a very popular eating researcher - until in 2017 some researchers looked at his publications more closely and found a lot of inconsistencies and statistical problems. Wansink refused to share the data.</p>
<p>. . .</p>
<p>There was a Buzzfeed article, which reported</p>
<blockquote class="blockquote">
<p>The p-value was 0.06, just shy of the gold standard cutoff of 0.05. It was a ‚Äústicking point,‚Äù as he put it in a Jan.&nbsp;7, 2012, email. ‚Ä¶ ‚ÄúIt seems to me it should be lower,‚Äù he wrote, attaching a draft. ‚ÄúDo you want to take a look at it and see what you think. If you can get the data, and it needs some tweeking, it would be good to get that one value below .05.‚Äù ‚Ä¶</p>
</blockquote>
<p>. . .</p>
<p>Wansink eventually resigned after a number of his papers had been retracted.</p>
</section>
<section id="the-reproducibility-crisis-in-science" class="level2">
<h2 class="anchored" data-anchor-id="the-reproducibility-crisis-in-science">The Reproducibility Crisis in Science</h2>
<p>In 2015, the paper ‚ÄúEstimating the reproducibility of psychological science‚Äù(<a href="https://doi.org/10.1126/science.aac4716">Open Science Collaboration, 2015</a>) was published. It showed that out of 100 published studies with originally 97% significant results, only 37% could be replicated (i.e., were also significant in the replication). Also, the average effect size replicated was <strong>half</strong> of the average original publication.</p>
<p>. . .</p>
<p>This was actually predicted already in 2005 in a paper by the (now in-)famous John Ioannidis. In the paper ‚Äú<a href="https://doi.org/10.1371/journal.pmed.0020124">Why most published research findings are false</a>‚Äù, he argued that the use of Null Hypothesis Significance Testing (NHST) will necessarily lead to high levels of false results.</p>
</section>
<section id="positive-predictive-value-and-statistical-significance" class="level2">
<h2 class="anchored" data-anchor-id="positive-predictive-value-and-statistical-significance">Positive Predictive Value and Statistical Significance</h2>
<p><strong>Positive Predictive Value (PPV)</strong>: Statistically significant findings that are actually true. <span class="math inline">\(P(\text{Effect true |  significant result})\)</span>!</p>
<p><strong>Type I error</strong>/<strong>False positives</strong>: How many of the statistically significant findings do we expect to be false? Usually 5% if <span class="math inline">\(\alpha=0.05\)</span>.</p>
<p><strong>Type II error</strong>/<strong>False negatives</strong>: How many of the non-significant findings do we expect to actually be true effects? Usually something like <span class="math inline">\(\beta=0.20\)</span>.</p>
<p>Statistical <strong>Power</strong>: How likely is it for our study design to actually find a true effect? I.e., if we have a power of 50%, we would only find a true effect at chance level. Power is the inverse of the Type II error: e.g.&nbsp;<span class="math inline">\(\text{power} = 1\)</span> <span class="math inline">\(- \beta\)</span>.<br>
We can increase power with increasing sample size!</p>
<p>. . .</p>
<p><span class="math display">\[PPV = \frac{P(\text{true positive result})}{P(\text{true positive result}) + P(\text{false positive result})}\]</span></p>
<p><span class="math display">\[P(\text{true positive result}) = P(\text{H is true}) * Power\]</span></p>
<p><span class="math display">\[P(\text{false positive result}) = (1 - P(\text{H is true})) * \alpha\]</span></p>
<p>We don‚Äôt know <span class="math inline">\(P(\text{H is true})\)</span>! But we can assume how likely it is for the specific research field: <a href="http://shinyapps.org/showapp.php?app=https://shiny.psy.lmu.de/felix/PPV">PPV App</a></p>
</section>
<section id="the-winners-curse" class="level2">
<h2 class="anchored" data-anchor-id="the-winners-curse">The Winner‚Äôs Curse</h2>
<p>Effect sizes estimated from a significant result are usually an overestimate of the true effect size!<br>
We have simulated experiments with a true effect size of <span class="math inline">\(.2\)</span> (red dotted line) and varying statistical power. For every power, we select the highest effect size found (the ‚Äúwinner‚Äù in an explorative analysis).</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb2"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb2-1"><a href="#cb2-1" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(tidyverse)</span>
<span id="cb2-2"><a href="#cb2-2" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(cowplot)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stderr">
<pre><code>
Attache Paket: 'cowplot'</code></pre>
</div>
<div class="cell-output cell-output-stderr">
<pre><code>Das folgende Objekt ist maskiert 'package:patchwork':

    align_plots</code></pre>
</div>
<div class="cell-output cell-output-stderr">
<pre><code>Das folgende Objekt ist maskiert 'package:lubridate':

    stamp</code></pre>
</div>
<div class="sourceCode cell-code" id="cb6"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb6-1"><a href="#cb6-1" aria-hidden="true" tabindex="-1"></a>trueEffectSize<span class="ot">=</span><span class="fl">0.2</span></span>
<span id="cb6-2"><a href="#cb6-2" aria-hidden="true" tabindex="-1"></a>dfCurse<span class="ot">=</span><span class="fu">data.frame</span>(<span class="at">sampSize=</span><span class="fu">seq</span>(<span class="dv">20</span>,<span class="dv">300</span>,<span class="dv">20</span>)) <span class="sc">%&gt;%</span></span>
<span id="cb6-3"><a href="#cb6-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">effectSize=</span>trueEffectSize,</span>
<span id="cb6-4"><a href="#cb6-4" aria-hidden="true" tabindex="-1"></a>         <span class="at">alpha=</span><span class="fl">0.05</span>)</span>
<span id="cb6-5"><a href="#cb6-5" aria-hidden="true" tabindex="-1"></a>simCurse <span class="ot">=</span> <span class="cf">function</span>(df,<span class="at">nruns=</span><span class="dv">1000</span>){</span>
<span id="cb6-6"><a href="#cb6-6" aria-hidden="true" tabindex="-1"></a>  sigResults<span class="ot">=</span><span class="dv">0</span></span>
<span id="cb6-7"><a href="#cb6-7" aria-hidden="true" tabindex="-1"></a>  sigEffects<span class="ot">=</span><span class="fu">c</span>()</span>
<span id="cb6-8"><a href="#cb6-8" aria-hidden="true" tabindex="-1"></a>  <span class="cf">for</span> (i <span class="cf">in</span> <span class="dv">1</span><span class="sc">:</span>nruns){</span>
<span id="cb6-9"><a href="#cb6-9" aria-hidden="true" tabindex="-1"></a>    tmpData<span class="ot">=</span><span class="fu">rnorm</span>(df<span class="sc">$</span>sampSize,<span class="at">mean=</span>df<span class="sc">$</span>effectSize,<span class="at">sd=</span><span class="dv">1</span>)</span>
<span id="cb6-10"><a href="#cb6-10" aria-hidden="true" tabindex="-1"></a>    ttestResult<span class="ot">=</span><span class="fu">t.test</span>(tmpData)</span>
<span id="cb6-11"><a href="#cb6-11" aria-hidden="true" tabindex="-1"></a>    <span class="cf">if</span> (ttestResult<span class="sc">$</span>p.value<span class="sc">&lt;</span>df<span class="sc">$</span>alpha){</span>
<span id="cb6-12"><a href="#cb6-12" aria-hidden="true" tabindex="-1"></a>      sigResults <span class="ot">=</span> sigResults <span class="sc">+</span> <span class="dv">1</span></span>
<span id="cb6-13"><a href="#cb6-13" aria-hidden="true" tabindex="-1"></a>      sigEffects<span class="ot">=</span><span class="fu">c</span>(sigEffects,ttestResult<span class="sc">$</span>estimate)</span>
<span id="cb6-14"><a href="#cb6-14" aria-hidden="true" tabindex="-1"></a>    }</span>
<span id="cb6-15"><a href="#cb6-15" aria-hidden="true" tabindex="-1"></a>  }</span>
<span id="cb6-16"><a href="#cb6-16" aria-hidden="true" tabindex="-1"></a>  df<span class="sc">$</span>power<span class="ot">=</span>sigResults<span class="sc">/</span>nruns</span>
<span id="cb6-17"><a href="#cb6-17" aria-hidden="true" tabindex="-1"></a>  df<span class="sc">$</span>effectSizeEstimate<span class="ot">=</span><span class="fu">mean</span>(sigEffects)</span>
<span id="cb6-18"><a href="#cb6-18" aria-hidden="true" tabindex="-1"></a>  <span class="fu">return</span>(df)</span>
<span id="cb6-19"><a href="#cb6-19" aria-hidden="true" tabindex="-1"></a>}</span>
<span id="cb6-20"><a href="#cb6-20" aria-hidden="true" tabindex="-1"></a>dfCurse <span class="ot">=</span> dfCurse <span class="sc">%&gt;%</span> <span class="fu">group_by</span>(sampSize) <span class="sc">%&gt;%</span> <span class="fu">do</span>(<span class="fu">simCurse</span>(.))</span>
<span id="cb6-21"><a href="#cb6-21" aria-hidden="true" tabindex="-1"></a>p1 <span class="ot">&lt;-</span> <span class="fu">ggplot</span>(dfCurse,<span class="fu">aes</span>(power,effectSizeEstimate)) <span class="sc">+</span></span>
<span id="cb6-22"><a href="#cb6-22" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_line</span>(<span class="at">size=</span><span class="dv">1</span>) <span class="sc">+</span></span>
<span id="cb6-23"><a href="#cb6-23" aria-hidden="true" tabindex="-1"></a>  <span class="fu">ylim</span>(<span class="dv">0</span>,<span class="fu">max</span>(dfCurse<span class="sc">$</span>effectSizeEstimate)<span class="sc">*</span><span class="fl">1.2</span>) <span class="sc">+</span></span>
<span id="cb6-24"><a href="#cb6-24" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_hline</span>(<span class="at">yintercept =</span> trueEffectSize,<span class="at">size=</span><span class="dv">1</span>,<span class="at">linetype=</span><span class="st">'dotted'</span>,<span class="at">color=</span><span class="st">'red'</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stderr">
<pre><code>Warning: Using `size` aesthetic for lines was deprecated in ggplot2 3.4.0.
‚Ñπ Please use `linewidth` instead.</code></pre>
</div>
<div class="sourceCode cell-code" id="cb8"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb8-1"><a href="#cb8-1" aria-hidden="true" tabindex="-1"></a><span class="co"># single</span></span>
<span id="cb8-2"><a href="#cb8-2" aria-hidden="true" tabindex="-1"></a>sampSize<span class="ot">=</span><span class="dv">60</span></span>
<span id="cb8-3"><a href="#cb8-3" aria-hidden="true" tabindex="-1"></a>effectSize<span class="ot">=</span><span class="fl">0.2</span></span>
<span id="cb8-4"><a href="#cb8-4" aria-hidden="true" tabindex="-1"></a>nruns<span class="ot">=</span><span class="dv">1000</span></span>
<span id="cb8-5"><a href="#cb8-5" aria-hidden="true" tabindex="-1"></a>alpha<span class="ot">=</span><span class="fl">0.05</span></span>
<span id="cb8-6"><a href="#cb8-6" aria-hidden="true" tabindex="-1"></a>df<span class="ot">=</span><span class="fu">data.frame</span>(<span class="at">idx=</span><span class="fu">seq</span>(<span class="dv">1</span>,nruns)) <span class="sc">%&gt;%</span></span>
<span id="cb8-7"><a href="#cb8-7" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">pval=</span><span class="cn">NA</span>,</span>
<span id="cb8-8"><a href="#cb8-8" aria-hidden="true" tabindex="-1"></a>         <span class="at">estimate=</span><span class="cn">NA</span>)</span>
<span id="cb8-9"><a href="#cb8-9" aria-hidden="true" tabindex="-1"></a><span class="cf">for</span> (i <span class="cf">in</span> <span class="dv">1</span><span class="sc">:</span>nruns){</span>
<span id="cb8-10"><a href="#cb8-10" aria-hidden="true" tabindex="-1"></a>  tmpData<span class="ot">=</span><span class="fu">rnorm</span>(sampSize,<span class="at">mean=</span>effectSize,<span class="at">sd=</span><span class="dv">1</span>)</span>
<span id="cb8-11"><a href="#cb8-11" aria-hidden="true" tabindex="-1"></a>  ttestResult<span class="ot">=</span><span class="fu">t.test</span>(tmpData)</span>
<span id="cb8-12"><a href="#cb8-12" aria-hidden="true" tabindex="-1"></a>  df<span class="sc">$</span>pval[i]<span class="ot">=</span>ttestResult<span class="sc">$</span>p.value</span>
<span id="cb8-13"><a href="#cb8-13" aria-hidden="true" tabindex="-1"></a>  df<span class="sc">$</span>estimate[i]<span class="ot">=</span>ttestResult<span class="sc">$</span>estimate</span>
<span id="cb8-14"><a href="#cb8-14" aria-hidden="true" tabindex="-1"></a>}</span>
<span id="cb8-15"><a href="#cb8-15" aria-hidden="true" tabindex="-1"></a>df <span class="ot">=</span> df <span class="sc">%&gt;%</span></span>
<span id="cb8-16"><a href="#cb8-16" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">significant=</span>pval<span class="sc">&lt;</span>alpha) <span class="sc">%&gt;%</span></span>
<span id="cb8-17"><a href="#cb8-17" aria-hidden="true" tabindex="-1"></a>  <span class="fu">group_by</span>(significant)</span>
<span id="cb8-18"><a href="#cb8-18" aria-hidden="true" tabindex="-1"></a>power<span class="ot">=</span><span class="fu">mean</span>(df<span class="sc">$</span>pval<span class="sc">&lt;</span>alpha)</span>
<span id="cb8-19"><a href="#cb8-19" aria-hidden="true" tabindex="-1"></a>meanSigEffect<span class="ot">=</span><span class="fu">mean</span>(df<span class="sc">$</span>estimate[df<span class="sc">$</span>pval<span class="sc">&lt;</span>alpha])</span>
<span id="cb8-20"><a href="#cb8-20" aria-hidden="true" tabindex="-1"></a>meanTrueEffect<span class="ot">=</span><span class="fu">mean</span>(df<span class="sc">$</span>estimate)</span>
<span id="cb8-21"><a href="#cb8-21" aria-hidden="true" tabindex="-1"></a>p2 <span class="ot">&lt;-</span> <span class="fu">ggplot</span>(df,<span class="fu">aes</span>(estimate,<span class="at">fill=</span>significant)) <span class="sc">+</span> </span>
<span id="cb8-22"><a href="#cb8-22" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_histogram</span>(<span class="at">bins=</span><span class="dv">50</span>)</span>
<span id="cb8-23"><a href="#cb8-23" aria-hidden="true" tabindex="-1"></a><span class="fu">plot_grid</span>(p1, p2)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<div>
<figure class="figure">
<p><img src="W15_RepResearchR_files/figure-html/unnamed-chunk-2-1.png" class="img-fluid figure-img" width="672"></p>
</figure>
</div>
</div>
</div>
<p>In the left plot, you can see that <em>estimated</em> effect sizes (sampling error!) are especially overestimated for studies with low power.<br>
On the right is a histogram showing effect size <em>estimates</em> for a number of simulated experiments. Non-significant results are shown in red, significant ones in blue.</p>
<div class="notes">
<p>Significance depends on effect size and sample size (standard error =&gt; <code>sqrt(n)</code>).</p>
<p>This shows us that only if power is high and the effect is large will the ES estimate be close to realistic.</p>
</div>
</section>
<section id="questionable-research-practices" class="level2">
<h2 class="anchored" data-anchor-id="questionable-research-practices">Questionable Research Practices</h2>
<p>Bem in ‚ÄúThe Compleat Academic: A Career Guide‚Äù (published by <a href="https://www.ncbi.nlm.nih.gov/pmc/articles/PMC3592591/">Darley, Zanna, &amp; Roediger, 2004</a>)</p>
<blockquote class="blockquote">
<p><strong>Which article should you write?</strong> There are two possible articles you can write: (1) the article you planned to write when you designed your study or (2) the article that makes the most sense now that you have seen the results. They are rarely the same, and the correct answer is (2).</p>
</blockquote>
<p>. . .</p>
<p>This is <strong><em>HIGHLY</em></strong> problematic! üôà</p>
<p><strong>HARKing</strong>: Hypothesizing After the Results are Known<br>
reframing a <em>post-hoc</em> conclusion as an <em>a priori</em> prediction (in which we have stronger faith).</p>
<p>. . .</p>
<blockquote class="blockquote">
<p><strong>Analyzing data</strong> Examine them from every angle. Analyze the sexes separately. Make up new composite indices. If a datum suggests a new hypothesis, try to find further evidence for it elsewhere in the data. If you see dim traces of interesting patterns, try to reorganize the data to bring them into bolder relief. If there are participants you don‚Äôt like, or trials, observers, or interviewers who gave you anomalous results, drop them (temporarily). Go on a fishing expedition for something ‚Äî anything ‚Äî interesting. No, this is not immoral.</p>
</blockquote>
<p>. . .</p>
<p><strong>p-hacking</strong>: trying different analyses until one finds a significant result.</p>
<p>-&gt; Increases false positive rate!</p>
<div class="notes">
<p>HARKing: moving the goalpost so that it ends up wherever the ball goes. Difficult to disconfirm ideas.</p>
<p>p-hacking:</p>
<ul>
<li><p>Analyze data after every subject, and stop collecting data once p&lt;.05</p></li>
<li><p>Analyze many different variables, but only report those with p&lt;.05</p></li>
<li><p>Collect many different experimental conditions, but only report those with p&lt;.05</p></li>
<li><p>Exclude participants to get p&lt;.05</p></li>
<li><p>Transform the data to get p&lt;.05</p></li>
</ul>
<p><strong>Add publication pressure etc. 7 sins?</strong></p>
</div>
</section>
<section id="questionable-research-practices-2" class="level2">
<h2 class="anchored" data-anchor-id="questionable-research-practices-2">Questionable Research Practices 2</h2>
<div class="quarto-figure quarto-figure-center">
<figure class="figure">
<p><a href="https://www.nature.com/articles/s41562-016-0021"><img src="images/RepRes_Munafo.webp" class="img-fluid figure-img" alt="The Research Cycle - and where QRPs play a role"></a></p>
<figcaption>The Research Cycle - and where QRPs play a role</figcaption>
</figure>
</div>
</section>
</section>
<section id="doing-reproducible-research" class="level1">
<h1>Doing Reproducible Research</h1>
<section id="preregistration" class="level2">
<h2 class="anchored" data-anchor-id="preregistration">Preregistration</h2>
<p>Submit a detailed description of a study (incl.&nbsp;all data analyses) to a trusted, time-stamped repository (<a href="https://osf.io/" class="uri">https://osf.io/</a> or <a href="https://aspredicted.org/" class="uri">https://aspredicted.org/</a>).</p>
<p>-&gt; Provides greater transparency and trust that the analyses are not p-hacked or other questionable research practices were used.</p>
<p>-&gt; Resulted in an increase in published non-significant findings (good because they are not lost in the ‚Äúfile drawer‚Äù and remain available for meta-analyses).</p>
</section>
<section id="reproducible-practices" class="level2">
<h2 class="anchored" data-anchor-id="reproducible-practices">Reproducible Practices</h2>
<p><a href="https://doi.org/10.1177/0956797611417632">Simmons, Nelson, and Simonsohn (2011)</a> suggested the following standards for making research more reproducible:</p>
<div class="incremental">
<ul class="incremental">
<li><p>Authors must decide the rule for terminating data collection before data collection begins and report this rule in the article.</p></li>
<li><p>Authors must collect at least 20 observations per cell or else provide a compelling cost-of-data-collection justification.</p></li>
<li><p>Authors must list all variables collected in a study.</p></li>
<li><p>Authors must report all experimental conditions, including failed manipulations.</p></li>
<li><p>If observations are eliminated, authors must also report what the statistical results are if those observations are included.</p></li>
<li><p>If an analysis includes a covariate, authors must report the statistical results of the analysis without the covariate.</p></li>
</ul>
</div>
</section>
<section id="replication" class="level2">
<h2 class="anchored" data-anchor-id="replication">Replication</h2>
<p>Other researchers should be able to perform the same study and obtain the same result.</p>
<p>. . .</p>
<p>It would be a good practice to replicate your own finding in a new (sufficiently powered) sample. Not every replication will be successful (80% power = 1/5 chance of getting a non-significant finding although there is a true effect!).</p>
<p>A small p-value does not necessarily provide stronger evidence for your hypothesis! (Although a p-value close to .05 is never strong evidence‚Ä¶).</p>
</section>
<section id="doing-reproducible-data-analysis" class="level2">
<h2 class="anchored" data-anchor-id="doing-reproducible-data-analysis">Doing Reproducible Data Analysis</h2>
<p>Replicating another lab‚Äôs findings is crucial, but another aspect of reproducibility is to be able to reproduce someone‚Äôs analysis on their own data: <strong>computational reproducibility</strong>.</p>
<p>For this, it is of course necessary that data and code are openly shared (on e.g.&nbsp;Github, osf.io, Zenodo, OpenNeuro‚Ä¶). Furthermore, scripted analyses, e.g using R, are highly preferred over point-and-click software, because it doesn‚Äôt document what was actually clicked (and you can‚Äôt comment it - there are some exceptions).</p>
</section>
<section id="doing-reproducible-data-analysis-2" class="level2">
<h2 class="anchored" data-anchor-id="doing-reproducible-data-analysis-2">Doing Reproducible Data Analysis 2</h2>
<p>There are a number of ways to make you code even more reproducible, such as using version control (Git/Github) and containers or virtual environments, which ensure e.g.&nbsp;that the same version of the software (and packages etc.) was used.</p>
<div class="quarto-figure quarto-figure-center">
<figure class="figure">
<p><a href="https://the-turing-way.netlify.app/"><img src="images/TuringRepRes.jpg" class="img-fluid figure-img" width="366" alt="The Turing Way of Reproducible Research"></a></p>
<figcaption>The Turing Way of Reproducible Research</figcaption>
</figure>
</div>
</section>
</section>
<section id="thanks" class="level1">
<h1>Thanks!</h1>
<p><strong>Learning objectives</strong>:</p>
<ul>
<li><p>Describe the concept of P-hacking and its effects on scientific practice</p></li>
<li><p>Describe the concept of positive predictive value and its relation to statistical power</p></li>
<li><p>Describe the concept of pre-registration and how it can help protect against questionable research practices</p></li>
</ul>


</section>

</main> <!-- /main -->
<script id="quarto-html-after-body" type="application/javascript">
window.document.addEventListener("DOMContentLoaded", function (event) {
  const toggleBodyColorMode = (bsSheetEl) => {
    const mode = bsSheetEl.getAttribute("data-mode");
    const bodyEl = window.document.querySelector("body");
    if (mode === "dark") {
      bodyEl.classList.add("quarto-dark");
      bodyEl.classList.remove("quarto-light");
    } else {
      bodyEl.classList.add("quarto-light");
      bodyEl.classList.remove("quarto-dark");
    }
  }
  const toggleBodyColorPrimary = () => {
    const bsSheetEl = window.document.querySelector("link#quarto-bootstrap");
    if (bsSheetEl) {
      toggleBodyColorMode(bsSheetEl);
    }
  }
  toggleBodyColorPrimary();  
  const icon = "Óßã";
  const anchorJS = new window.AnchorJS();
  anchorJS.options = {
    placement: 'right',
    icon: icon
  };
  anchorJS.add('.anchored');
  const isCodeAnnotation = (el) => {
    for (const clz of el.classList) {
      if (clz.startsWith('code-annotation-')) {                     
        return true;
      }
    }
    return false;
  }
  const clipboard = new window.ClipboardJS('.code-copy-button', {
    text: function(trigger) {
      const codeEl = trigger.previousElementSibling.cloneNode(true);
      for (const childEl of codeEl.children) {
        if (isCodeAnnotation(childEl)) {
          childEl.remove();
        }
      }
      return codeEl.innerText;
    }
  });
  clipboard.on('success', function(e) {
    // button target
    const button = e.trigger;
    // don't keep focus
    button.blur();
    // flash "checked"
    button.classList.add('code-copy-button-checked');
    var currentTitle = button.getAttribute("title");
    button.setAttribute("title", "Copied!");
    let tooltip;
    if (window.bootstrap) {
      button.setAttribute("data-bs-toggle", "tooltip");
      button.setAttribute("data-bs-placement", "left");
      button.setAttribute("data-bs-title", "Copied!");
      tooltip = new bootstrap.Tooltip(button, 
        { trigger: "manual", 
          customClass: "code-copy-button-tooltip",
          offset: [0, -8]});
      tooltip.show();    
    }
    setTimeout(function() {
      if (tooltip) {
        tooltip.hide();
        button.removeAttribute("data-bs-title");
        button.removeAttribute("data-bs-toggle");
        button.removeAttribute("data-bs-placement");
      }
      button.setAttribute("title", currentTitle);
      button.classList.remove('code-copy-button-checked');
    }, 1000);
    // clear code selection
    e.clearSelection();
  });
    var localhostRegex = new RegExp(/^(?:http|https):\/\/localhost\:?[0-9]*\//);
    var mailtoRegex = new RegExp(/^mailto:/);
      var filterRegex = new RegExp('/' + window.location.host + '/');
    var isInternal = (href) => {
        return filterRegex.test(href) || localhostRegex.test(href) || mailtoRegex.test(href);
    }
    // Inspect non-navigation links and adorn them if external
 	var links = window.document.querySelectorAll('a[href]:not(.nav-link):not(.navbar-brand):not(.toc-action):not(.sidebar-link):not(.sidebar-item-toggle):not(.pagination-link):not(.no-external):not([aria-hidden]):not(.dropdown-item):not(.quarto-navigation-tool)');
    for (var i=0; i<links.length; i++) {
      const link = links[i];
      if (!isInternal(link.href)) {
        // undo the damage that might have been done by quarto-nav.js in the case of
        // links that we want to consider external
        if (link.dataset.originalHref !== undefined) {
          link.href = link.dataset.originalHref;
        }
      }
    }
  function tippyHover(el, contentFn, onTriggerFn, onUntriggerFn) {
    const config = {
      allowHTML: true,
      maxWidth: 500,
      delay: 100,
      arrow: false,
      appendTo: function(el) {
          return el.parentElement;
      },
      interactive: true,
      interactiveBorder: 10,
      theme: 'quarto',
      placement: 'bottom-start',
    };
    if (contentFn) {
      config.content = contentFn;
    }
    if (onTriggerFn) {
      config.onTrigger = onTriggerFn;
    }
    if (onUntriggerFn) {
      config.onUntrigger = onUntriggerFn;
    }
    window.tippy(el, config); 
  }
  const noterefs = window.document.querySelectorAll('a[role="doc-noteref"]');
  for (var i=0; i<noterefs.length; i++) {
    const ref = noterefs[i];
    tippyHover(ref, function() {
      // use id or data attribute instead here
      let href = ref.getAttribute('data-footnote-href') || ref.getAttribute('href');
      try { href = new URL(href).hash; } catch {}
      const id = href.replace(/^#\/?/, "");
      const note = window.document.getElementById(id);
      if (note) {
        return note.innerHTML;
      } else {
        return "";
      }
    });
  }
  const xrefs = window.document.querySelectorAll('a.quarto-xref');
  const processXRef = (id, note) => {
    // Strip column container classes
    const stripColumnClz = (el) => {
      el.classList.remove("page-full", "page-columns");
      if (el.children) {
        for (const child of el.children) {
          stripColumnClz(child);
        }
      }
    }
    stripColumnClz(note)
    if (id === null || id.startsWith('sec-')) {
      // Special case sections, only their first couple elements
      const container = document.createElement("div");
      if (note.children && note.children.length > 2) {
        container.appendChild(note.children[0].cloneNode(true));
        for (let i = 1; i < note.children.length; i++) {
          const child = note.children[i];
          if (child.tagName === "P" && child.innerText === "") {
            continue;
          } else {
            container.appendChild(child.cloneNode(true));
            break;
          }
        }
        if (window.Quarto?.typesetMath) {
          window.Quarto.typesetMath(container);
        }
        return container.innerHTML
      } else {
        if (window.Quarto?.typesetMath) {
          window.Quarto.typesetMath(note);
        }
        return note.innerHTML;
      }
    } else {
      // Remove any anchor links if they are present
      const anchorLink = note.querySelector('a.anchorjs-link');
      if (anchorLink) {
        anchorLink.remove();
      }
      if (window.Quarto?.typesetMath) {
        window.Quarto.typesetMath(note);
      }
      // TODO in 1.5, we should make sure this works without a callout special case
      if (note.classList.contains("callout")) {
        return note.outerHTML;
      } else {
        return note.innerHTML;
      }
    }
  }
  for (var i=0; i<xrefs.length; i++) {
    const xref = xrefs[i];
    tippyHover(xref, undefined, function(instance) {
      instance.disable();
      let url = xref.getAttribute('href');
      let hash = undefined; 
      if (url.startsWith('#')) {
        hash = url;
      } else {
        try { hash = new URL(url).hash; } catch {}
      }
      if (hash) {
        const id = hash.replace(/^#\/?/, "");
        const note = window.document.getElementById(id);
        if (note !== null) {
          try {
            const html = processXRef(id, note.cloneNode(true));
            instance.setContent(html);
          } finally {
            instance.enable();
            instance.show();
          }
        } else {
          // See if we can fetch this
          fetch(url.split('#')[0])
          .then(res => res.text())
          .then(html => {
            const parser = new DOMParser();
            const htmlDoc = parser.parseFromString(html, "text/html");
            const note = htmlDoc.getElementById(id);
            if (note !== null) {
              const html = processXRef(id, note);
              instance.setContent(html);
            } 
          }).finally(() => {
            instance.enable();
            instance.show();
          });
        }
      } else {
        // See if we can fetch a full url (with no hash to target)
        // This is a special case and we should probably do some content thinning / targeting
        fetch(url)
        .then(res => res.text())
        .then(html => {
          const parser = new DOMParser();
          const htmlDoc = parser.parseFromString(html, "text/html");
          const note = htmlDoc.querySelector('main.content');
          if (note !== null) {
            // This should only happen for chapter cross references
            // (since there is no id in the URL)
            // remove the first header
            if (note.children.length > 0 && note.children[0].tagName === "HEADER") {
              note.children[0].remove();
            }
            const html = processXRef(null, note);
            instance.setContent(html);
          } 
        }).finally(() => {
          instance.enable();
          instance.show();
        });
      }
    }, function(instance) {
    });
  }
      let selectedAnnoteEl;
      const selectorForAnnotation = ( cell, annotation) => {
        let cellAttr = 'data-code-cell="' + cell + '"';
        let lineAttr = 'data-code-annotation="' +  annotation + '"';
        const selector = 'span[' + cellAttr + '][' + lineAttr + ']';
        return selector;
      }
      const selectCodeLines = (annoteEl) => {
        const doc = window.document;
        const targetCell = annoteEl.getAttribute("data-target-cell");
        const targetAnnotation = annoteEl.getAttribute("data-target-annotation");
        const annoteSpan = window.document.querySelector(selectorForAnnotation(targetCell, targetAnnotation));
        const lines = annoteSpan.getAttribute("data-code-lines").split(",");
        const lineIds = lines.map((line) => {
          return targetCell + "-" + line;
        })
        let top = null;
        let height = null;
        let parent = null;
        if (lineIds.length > 0) {
            //compute the position of the single el (top and bottom and make a div)
            const el = window.document.getElementById(lineIds[0]);
            top = el.offsetTop;
            height = el.offsetHeight;
            parent = el.parentElement.parentElement;
          if (lineIds.length > 1) {
            const lastEl = window.document.getElementById(lineIds[lineIds.length - 1]);
            const bottom = lastEl.offsetTop + lastEl.offsetHeight;
            height = bottom - top;
          }
          if (top !== null && height !== null && parent !== null) {
            // cook up a div (if necessary) and position it 
            let div = window.document.getElementById("code-annotation-line-highlight");
            if (div === null) {
              div = window.document.createElement("div");
              div.setAttribute("id", "code-annotation-line-highlight");
              div.style.position = 'absolute';
              parent.appendChild(div);
            }
            div.style.top = top - 2 + "px";
            div.style.height = height + 4 + "px";
            div.style.left = 0;
            let gutterDiv = window.document.getElementById("code-annotation-line-highlight-gutter");
            if (gutterDiv === null) {
              gutterDiv = window.document.createElement("div");
              gutterDiv.setAttribute("id", "code-annotation-line-highlight-gutter");
              gutterDiv.style.position = 'absolute';
              const codeCell = window.document.getElementById(targetCell);
              const gutter = codeCell.querySelector('.code-annotation-gutter');
              gutter.appendChild(gutterDiv);
            }
            gutterDiv.style.top = top - 2 + "px";
            gutterDiv.style.height = height + 4 + "px";
          }
          selectedAnnoteEl = annoteEl;
        }
      };
      const unselectCodeLines = () => {
        const elementsIds = ["code-annotation-line-highlight", "code-annotation-line-highlight-gutter"];
        elementsIds.forEach((elId) => {
          const div = window.document.getElementById(elId);
          if (div) {
            div.remove();
          }
        });
        selectedAnnoteEl = undefined;
      };
        // Handle positioning of the toggle
    window.addEventListener(
      "resize",
      throttle(() => {
        elRect = undefined;
        if (selectedAnnoteEl) {
          selectCodeLines(selectedAnnoteEl);
        }
      }, 10)
    );
    function throttle(fn, ms) {
    let throttle = false;
    let timer;
      return (...args) => {
        if(!throttle) { // first call gets through
            fn.apply(this, args);
            throttle = true;
        } else { // all the others get throttled
            if(timer) clearTimeout(timer); // cancel #2
            timer = setTimeout(() => {
              fn.apply(this, args);
              timer = throttle = false;
            }, ms);
        }
      };
    }
      // Attach click handler to the DT
      const annoteDls = window.document.querySelectorAll('dt[data-target-cell]');
      for (const annoteDlNode of annoteDls) {
        annoteDlNode.addEventListener('click', (event) => {
          const clickedEl = event.target;
          if (clickedEl !== selectedAnnoteEl) {
            unselectCodeLines();
            const activeEl = window.document.querySelector('dt[data-target-cell].code-annotation-active');
            if (activeEl) {
              activeEl.classList.remove('code-annotation-active');
            }
            selectCodeLines(clickedEl);
            clickedEl.classList.add('code-annotation-active');
          } else {
            // Unselect the line
            unselectCodeLines();
            clickedEl.classList.remove('code-annotation-active');
          }
        });
      }
  const findCites = (el) => {
    const parentEl = el.parentElement;
    if (parentEl) {
      const cites = parentEl.dataset.cites;
      if (cites) {
        return {
          el,
          cites: cites.split(' ')
        };
      } else {
        return findCites(el.parentElement)
      }
    } else {
      return undefined;
    }
  };
  var bibliorefs = window.document.querySelectorAll('a[role="doc-biblioref"]');
  for (var i=0; i<bibliorefs.length; i++) {
    const ref = bibliorefs[i];
    const citeInfo = findCites(ref);
    if (citeInfo) {
      tippyHover(citeInfo.el, function() {
        var popup = window.document.createElement('div');
        citeInfo.cites.forEach(function(cite) {
          var citeDiv = window.document.createElement('div');
          citeDiv.classList.add('hanging-indent');
          citeDiv.classList.add('csl-entry');
          var biblioDiv = window.document.getElementById('ref-' + cite);
          if (biblioDiv) {
            citeDiv.innerHTML = biblioDiv.innerHTML;
          }
          popup.appendChild(citeDiv);
        });
        return popup.innerHTML;
      });
    }
  }
});
</script>
</div> <!-- /content -->




</body></html>